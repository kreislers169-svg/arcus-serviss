<!DOCTYPE html>
<html lang="lv">
<head>
    <meta charset="UTF-8">
    <title>Audi A6 C6 & Auto PortÄls</title>
    <style>
        :root { --ss-blue: #003399; --ss-orange: #FF9900; --ss-red: #dc3545; --ss-green: #28a745; --ss-bg: #f0f2f5; }
        body { background: var(--ss-bg); font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; }
        .wrapper { max-width: 1200px; margin: 0 auto; background: white; min-height: 100vh; display: flex; flex-direction: column; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        
        /* NavigÄcija */
        .header { background: var(--ss-blue); color: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid var(--ss-orange); }
        .nav-menu { background: #e9ecef; padding: 10px 25px; display: flex; gap: 20px; border-bottom: 1px solid #ccc; font-weight: bold; }
        .nav-item { cursor: pointer; color: var(--ss-blue); font-size: 14px; }

        /* Sekcijas */
        .section { padding: 25px; display: none; }
        .active-section { display: block; }

        /* Auth */
        #authSection { flex-grow: 1; display: flex; align-items: center; justify-content: center; background: #e9ecef; }
        .auth-card { width: 380px; padding: 35px; background: white; border-radius: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border-top: 5px solid var(--ss-blue); }
        .auth-card input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }

        /* SludinÄjumi */
        .ad-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .ad-card { border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: #fff; cursor: pointer; position: relative; }
        .ad-card img { width: 100%; height: 180px; object-fit: cover; }
        .ad-info { padding: 15px; }

        /* Formas elementu uzlabojumi */
        select, input, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-family: inherit; }
        
        /* ÄŒata stili */
        .chat-layout { display: grid; grid-template-columns: 280px 1fr; gap: 20px; height: 500px; border: 1px solid #ddd; }
        .chat-sidebar { background: #f8f9fa; border-right: 1px solid #ddd; overflow-y: auto; }
        .chat-history { flex-grow: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; background: white; }
        .msg { max-width: 75%; padding: 10px; border-radius: 10px; font-size: 14px; }
        .msg-sent { align-self: flex-end; background: var(--ss-blue); color: white; }
        .msg-rec { align-self: flex-start; background: #eee; }

        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-blue { background: var(--ss-blue); color: white; }
        .btn-orange { background: var(--ss-orange); color: white; }
        .btn-red { background: var(--ss-red); color: white; }
        .admin-badge { background: var(--ss-red); color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; }
        .hidden { display: none !important; }
        .status-msg { padding: 15px; margin-bottom: 20px; border-radius: 5px; text-align: center; font-weight: bold; display: none; background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="header">
        <div style="font-size:22px; font-weight:bold; cursor:pointer" onclick="showSection('home')">AUTO PORTÄ€LS</div>
        <div id="userHeader">Viesis</div>
    </div>

    <div id="mainNav" class="nav-menu hidden">
        <div class="nav-item" onclick="showSection('home')">SludinÄjumi</div>
        <div class="nav-item" onclick="showSection('chats')">ZiÅ†as ğŸ’¬</div>
        <div id="adminNavItem" class="nav-item hidden" style="color:var(--ss-red)" onclick="showSection('admin')">ğŸ›¡ï¸ Admin Panelis</div>
    </div>

    <div id="authSection" class="section active-section">
        <div class="auth-card">
            <h2 id="authTitle" style="text-align:center;">PieslÄ“gties</h2>
            <div id="loginFields">
                <input type="text" id="lUser" placeholder="LietotÄjvÄrds">
                <input type="password" id="lPass" placeholder="Parole">
                <button class="btn btn-blue" style="width:100%" onclick="login()">IenÄkt</button>
            </div>
            <div id="registerFields" class="hidden">
                <input type="text" id="rUser" placeholder="LietotÄjvÄrds">
                <input type="email" id="rEmail" placeholder="E-pasts">
                <input type="text" id="rPhone" placeholder="TÄlrunis (+371...)">
                <input type="password" id="rPass" placeholder="Parole">
                <button class="btn btn-orange" style="width:100%" onclick="register()">ReÄ£istrÄ“ties</button>
            </div>
            <p style="text-align:center; cursor:pointer; font-size:13px; color:var(--ss-blue); margin-top:15px;" onclick="toggleAuth()">PÄrslÄ“gt ienÄkÅ¡anu/reÄ£istrÄciju</p>
        </div>
    </div>

    <div id="home" class="section">
        <div id="successMsg" class="status-msg">SludinÄjums veiksmÄ«gi pievienots!</div>
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h2>Visi sludinÄjumi</h2>
            <button class="btn btn-orange" onclick="showSection('addAd')">+ Pievienot Auto</button>
        </div>
        <div class="ad-grid" id="adList"></div>
    </div>

    <div id="addAd" class="section">
        <h2>Pievienot jaunu sludinÄjumu</h2>
        <div style="max-width:600px; background:#fff; padding:20px; border:1px solid #ddd; border-radius:10px;">
            <label>Auto Marka</label>
            <select id="adBrand">
                <option value="Audi">Audi</option>
                <option value="BMW">BMW</option>
                <option value="Volkswagen">Volkswagen</option>
                <option value="Volvo">Volvo</option>
                <option value="Mercedes-Benz">Mercedes-Benz</option>
                <option value="Toyota">Toyota</option>
                <option value="Opel">Opel</option>
                <option value="Skoda">Skoda</option>
                <option value="Lexus">Lexus</option>
                <option value="Ford">Ford</option>
                <option value="Nissan">Nissan</option>
                <option value="Honda">Honda</option>
                <option value="Mazda">Mazda</option>
                <option value="Hyundai">Hyundai</option>
                <option value="Kia">Kia</option>
                <option value="Cits">Cita marka...</option>
            </select>
            <label>Modelis un dzinÄ“js</label><input type="text" id="adTitle" placeholder="Piem. A6 C6 2.7tdi CANA">
            <label>Cena (â‚¬)</label><input type="number" id="adPrice" placeholder="8500">
            <label>Gads</label><input type="number" id="adYear" placeholder="2010">
            <label>Foto</label><input type="file" id="adFile" accept="image/*">
            <label>Servisa vÄ“sture</label>
            <textarea id="adService" placeholder="Piem. Jaunas sprauslas, mainÄ«ta eÄ¼Ä¼a..."></textarea>
            <button class="btn btn-blue" style="width:100%" onclick="saveNewAd()">PublicÄ“t</button>
        </div>
    </div>

    <div id="detailView" class="section">
        <button class="btn" style="background:#eee; margin-bottom:20px;" onclick="showSection('home')">â† AtpakaÄ¼</button>
        <div id="adDetailsContent"></div>
    </div>

    <div id="chats" class="section">
        <h2>Tavas sarunas</h2>
        <div class="chat-layout">
            <div class="chat-sidebar" id="chatList"></div>
            <div class="chat-main" style="display:flex; flex-direction:column;">
                <div id="chatHistory" class="chat-history"><p style="text-align:center; margin-top:150px; color:#999;">IzvÄ“lies sarunu...</p></div>
                <div id="chatInputArea" class="hidden" style="padding:15px; border-top:1px solid #ddd; display:flex;">
                    <input type="text" id="msgInput" placeholder="Raksti ziÅ†u..." style="flex-grow:1;">
                    <button class="btn btn-blue" style="margin-left:10px;" onclick="sendMessage()">SÅ«tÄ«t</button>
                </div>
            </div>
        </div>
    </div>

    <div id="admin" class="section">
        <h2>ğŸ›¡ï¸ Administratora rÄ«ki</h2>
        <div id="adminUserTable"></div>
    </div>
</div>

<script>
    let users = JSON.parse(localStorage.getItem('final_v8_users')) || [{ name: 'admin', pass: 'admin123', role: 'admin', blocked: false }];
    let ads = JSON.parse(localStorage.getItem('final_v8_ads')) || [];
    let messages = JSON.parse(localStorage.getItem('final_v8_msgs')) || [];
    let currentUser = JSON.parse(sessionStorage.getItem('final_v8_session'));
    let activeChatPartner = null;

    // AUTH
    function toggleAuth() {
        document.getElementById('loginFields').classList.toggle('hidden');
        document.getElementById('registerFields').classList.toggle('hidden');
    }
    function login() {
        const u = document.getElementById('lUser').value;
        const p = document.getElementById('lPass').value;
        const user = users.find(x => x.name === u && x.pass === p);
        if(user && !user.blocked) { currentUser = user; sessionStorage.setItem('final_v8_session', JSON.stringify(user)); checkUI(); }
        else alert("KÄ¼Å«da vai konts bloÄ·Ä“ts!");
    }
    function register() {
        const u = document.getElementById('rUser').value;
        users.push({ name: u, pass: document.getElementById('rPass').value, role: 'user', blocked: false });
        localStorage.setItem('final_v8_users', JSON.stringify(users));
        alert("ReÄ£istrÄ“ts!"); toggleAuth();
    }
    function logout() { sessionStorage.clear(); location.reload(); }

    // UI
    function checkUI() {
        if(currentUser) {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('mainNav').classList.remove('hidden');
            const isAdmin = currentUser.role === 'admin';
            document.getElementById('userHeader').innerHTML = `${currentUser.name} ${isAdmin ? '<span class="admin-badge">ADMIN</span>' : ''} <button onclick="logout()">Iziet</button>`;
            if(isAdmin) document.getElementById('adminNavItem').classList.remove('hidden');
            showSection('home');
        }
    }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active-section'));
        document.getElementById(id).classList.add('active-section');
        if(id === 'home') renderAds();
        if(id === 'admin') renderAdmin();
        if(id === 'chats') renderChatList();
    }

    // ADS
    function renderAds() {
        const list = document.getElementById('adList');
        list.innerHTML = ads.map(ad => `
            <div class="ad-card">
                <div onclick="openAd(${ad.id})">
                    <img src="${ad.img || 'https://via.placeholder.com/300x180?text=Auto'}">
                    <div class="ad-info">
                        <b>${ad.brand} ${ad.title}</b><br>
                        <span style="color:var(--ss-blue); font-weight:bold;">${ad.price} â‚¬</span> | ${ad.year}.g
                    </div>
                </div>
                ${currentUser.role === 'admin' ? `<button class="btn-red" style="position:absolute; top:5px; right:5px; padding:5px; font-size:10px;" onclick="deleteAd(${ad.id})">DzÄ“st</button>` : ''}
            </div>
        `).join('');
    }

    async function saveNewAd() {
        const file = document.getElementById('adFile').files[0];
        let img = "";
        if(file) img = await new Promise(r => { const rd = new FileReader(); rd.onload = e => r(e.target.result); rd.readAsDataURL(file); });
        
        const ad = {
            id: Date.now(),
            brand: document.getElementById('adBrand').value,
            title: document.getElementById('adTitle').value,
            price: document.getElementById('adPrice').value,
            year: document.getElementById('adYear').value,
            service: document.getElementById('adService').value,
            owner: currentUser.name,
            img: img
        };
        ads.unshift(ad);
        localStorage.setItem('final_v8_ads', JSON.stringify(ads));
        document.getElementById('successMsg').style.display = 'block';
        showSection('home');
        setTimeout(() => document.getElementById('successMsg').style.display = 'none', 3000);
    }

    function deleteAd(id) {
        if(confirm("TieÅ¡Äm dzÄ“st Å¡o sludinÄjumu?")) {
            ads = ads.filter(a => a.id !== id);
            localStorage.setItem('final_v8_ads', JSON.stringify(ads));
            renderAds();
        }
    }

    function openAd(id) {
        const ad = ads.find(a => a.id === id);
        showSection('detailView');
        document.getElementById('adDetailsContent').innerHTML = `
            <div style="display:grid; grid-template-columns: 1fr 350px; gap:20px;">
                <img src="${ad.img || ''}" style="width:100%; border-radius:10px;">
                <div style="background:#f8f9fa; padding:20px; border-radius:10px;">
                    <h2>${ad.brand} ${ad.title}</h2>
                    <h3 style="color:var(--ss-blue)">${ad.price} â‚¬</h3>
                    <p><b>Gads:</b> ${ad.year}</p>
                    <p><b>Serviss:</b> ${ad.service || 'Nav info'}</p>
                    <p><b>PÄrdevÄ“js:</b> ${ad.owner}</p>
                    <button class="btn btn-blue" style="width:100%" onclick="startChat('${ad.owner}')">SazinÄties</button>
                </div>
            </div>
        `;
    }

    // CHAT
    function startChat(p) { if(p === currentUser.name) return; activeChatPartner = p; showSection('chats'); loadChat(p); }
    function renderChatList() {
        const pSet = new Set();
        messages.forEach(m => { if(m.from === currentUser.name) pSet.add(m.to); if(m.to === currentUser.name) pSet.add(m.from); });
        document.getElementById('chatList').innerHTML = Array.from(pSet).map(p => `
            <div style="padding:15px; border-bottom:1px solid #ddd; cursor:pointer; background:${activeChatPartner === p ? '#d0ebff' : ''}" onclick="loadChat('${p}')">${p}</div>
        `).join('');
    }
    function loadChat(p) {
        activeChatPartner = p; renderChatList();
        document.getElementById('chatInputArea').classList.remove('hidden');
        const hist = messages.filter(m => (m.from === currentUser.name && m.to === p) || (m.from === p && m.to === currentUser.name));
        document.getElementById('chatHistory').innerHTML = hist.map(m => `<div class="msg ${m.from === currentUser.name ? 'msg-sent' : 'msg-rec'}">${m.text}</div>`).join('');
    }
    function sendMessage() {
        const txt = document.getElementById('msgInput').value; if(!txt) return;
        messages.push({ from: currentUser.name, to: activeChatPartner, text: txt });
        localStorage.setItem('final_v8_msgs', JSON.stringify(messages));
        document.getElementById('msgInput').value = ''; loadChat(activeChatPartner);
    }

    // ADMIN
    function renderAdmin() {
        document.getElementById('adminUserTable').innerHTML = `
            <table border="1" style="width:100%; border-collapse:collapse;">
                <tr><th>LietotÄjs</th><th>Statuss</th><th>DarbÄ«ba</th></tr>
                ${users.filter(u => u.name !== 'admin').map(u => `
                    <tr>
                        <td>${u.name}</td>
                        <td style="color:${u.blocked ? 'red' : 'green'}">${u.blocked ? 'BloÄ·Ä“ts' : 'AktÄ«vs'}</td>
                        <td><button onclick="toggleBlock('${u.name}')">BloÄ·Ä“t/AtbloÄ·Ä“t</button></td>
                    </tr>
                `).join('')}
            </table>
        `;
    }
    function toggleBlock(n) {
        users = users.map(u => u.name === n ? {...u, blocked: !u.blocked} : u);
        localStorage.setItem('final_v8_users', JSON.stringify(users)); renderAdmin();
    }

    checkUI();
</script>
</body>
</html>