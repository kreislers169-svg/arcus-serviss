<!DOCTYPE html>
<html lang="lv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Portāls | Audi A6 C6 Edition</title>
    <style>
        :root { 
            --blue: #003399; --orange: #FF9900; --red: #dc3545; 
            --light: #f4f7f6; --dark: #333; --border: #ddd;
        }
        
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; background: var(--light); color: var(--dark); }
        .container { max-width: 1100px; margin: 0 auto; background: white; min-height: 100vh; display: flex; flex-direction: column; }

        /* --- NAVIGĀCIJA --- */
        header { background: var(--blue); color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--orange); }
        nav { background: #eee; padding: 0.8rem 2rem; display: flex; gap: 20px; border-bottom: 1px solid var(--border); }
        .nav-link { cursor: pointer; font-weight: bold; color: var(--blue); text-decoration: none; font-size: 14px; }
        .nav-link:hover { color: var(--orange); }

        /* --- SADAĻAS --- */
        .page { padding: 2rem; display: none; }
        .page.active { display: block; }

        /* --- FORMAS --- */
        .card { max-width: 500px; margin: 0 auto; padding: 2rem; border: 1px solid var(--border); border-radius: 8px; background: #fff; }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .btn { padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-blue { background: var(--blue); color: white; width: 100%; }
        .btn-orange { background: var(--orange); color: white; }
        .btn-logout { background: transparent; color: white; border: 1px solid white; padding: 5px 10px; font-size: 12px; }

        /* --- SLUDINĀJUMU REŽĢIS --- */
        .ad-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 25px; margin-top: 20px; }
        .ad-card { border: 1px solid var(--border); border-radius: 10px; overflow: hidden; background: white; transition: 0.3s; position: relative; }
        .ad-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .ad-card img { width: 100%; height: 180px; object-fit: cover; background: #eee; }
        .ad-content { padding: 15px; }
        .ad-price { color: var(--blue); font-size: 1.2rem; font-weight: bold; }

        .error { color: var(--red); font-size: 13px; margin-top: -5px; margin-bottom: 10px; display: none; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div style="font-size: 1.5rem; font-weight: bold; cursor: pointer;" onclick="router.goto('home')">AUTO PORTĀLS</div>
        <div id="user-status"></div>
    </header>

    <nav id="main-nav" class="hidden">
        <span class="nav-link" onclick="router.goto('home')">Visi sludinājumi</span>
        <span class="nav-link" onclick="router.goto('add-ad')">Pievienot auto</span>
        <span id="admin-link" class="nav-link hidden" style="color: var(--red);" onclick="router.goto('admin')">Admin</span>
    </nav>

    <section id="page-login" class="page active">
        <div class="card">
            <h2 id="auth-title">Pieslēgties</h2>
            <input type="text" id="auth-user" placeholder="Lietotājvārds">
            <input type="password" id="auth-pass" placeholder="Parole">
            <button class="btn btn-blue" onclick="auth.handle()">Ienākt / Reģistrēties</button>
            <p style="text-align: center; font-size: 12px; color: #666;">Jauns lietotājs? Ievadi vārdu un paroli, lai reģistrētos.</p>
        </div>
    </section>

    <section id="page-home" class="page">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2>Aktuālie piedāvājumi</h2>
            <select id="filter-brand" style="width: auto;" onchange="adsManager.render()">
                <option value="Visi">Visas markas</option>
                <option value="Audi">Audi</option>
                <option value="BMW">BMW</option>
                <option value="Volkswagen">VW</option>
            </select>
        </div>
        <div id="ad-list" class="ad-grid"></div>
    </section>

    <section id="page-add-ad" class="page">
        <div class="card" style="max-width: 600px;">
            <h2>Pievienot sludinājumu</h2>
            <label>Marka</label>
            <select id="field-brand">
                <option value="Audi">Audi</option>
                <option value="BMW">BMW</option>
                <option value="Volkswagen">VW</option>
                <option value="Volvo">Volvo</option>
            </select>
            <label>Modelis un dzinējs</label>
            <input type="text" id="field-title" placeholder="Piemēram: A6 C6 2.7tdi CANA">
            <label>Cena (€)</label>
            <input type="number" id="field-price" placeholder="Piemēram: 7500">
            <label>Izlaiduma gads</label>
            <input type="number" id="field-year" value="2010">
            <label>Attēls (max 2MB)</label>
            <input type="file" id="field-file" accept="image/*">
            <div id="file-error" class="error">Attēls ir pārāk liels!</div>
            <label>Apraksts</label>
            <textarea id="field-desc" rows="4" placeholder="Servisa vēsture, stāvoklis..."></textarea>
            <button class="btn btn-blue" onclick="adsManager.save()">Publicēt sludinājumu</button>
        </div>
    </section>

    <section id="page-admin" class="page">
        <h2>Lietotāju pārvaldība</h2>
        <div id="admin-user-list"></div>
    </section>
</div>

<script>
    // --- 1. DATU PĀRVALDĪBA (STORE) ---
    const store = {
        save: (key, data) => localStorage.setItem('auto_' + key, JSON.stringify(data)),
        load: (key, def) => JSON.parse(localStorage.getItem('auto_' + key)) || def,
        session: {
            set: (user) => sessionStorage.setItem('auto_user', JSON.stringify(user)),
            get: () => JSON.parse(sessionStorage.getItem('auto_user')),
            clear: () => sessionStorage.removeItem('auto_user')
        }
    };

    // --- 2. MARŠRUTĒTĀJS (ROUTER) ---
    const router = {
        goto: (pageId) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            if(pageId === 'home') adsManager.render();
            if(pageId === 'admin') adminManager.render();
        }
    };

    // --- 3. AUTORIZĀCIJA (AUTH) ---
    const auth = {
        handle: () => {
            const u = document.getElementById('auth-user').value.trim();
            const p = document.getElementById('auth-pass').value.trim();
            if(!u || !p) return alert("Aizpildi abus laukus!");

            let users = store.load('users', [{name: 'admin', pass: 'admin123', role: 'admin'}]);
            let user = users.find(x => x.name === u);

            if(!user) {
                user = { name: u, pass: p, role: 'user' };
                users.push(user);
                store.save('users', users);
            } else if(user.pass !== p) {
                return alert("Nepareiza parole!");
            }

            store.session.set(user);
            auth.updateUI();
        },
        updateUI: () => {
            const user = store.session.get();
            if(user) {
                document.getElementById('user-status').innerHTML = `
                    <span>Sveiks, <b>${user.name}</b></span> 
                    <button class="btn-logout" onclick="auth.logout()">Iziet</button>
                `;
                document.getElementById('main-nav').classList.remove('hidden');
                document.getElementById('page-login').classList.remove('active');
                if(user.role === 'admin') document.getElementById('admin-link').classList.remove('hidden');
                router.goto('home');
            }
        },
        logout: () => {
            store.session.clear();
            // Pilnīga lapas pārlādēšana, lai nodrošinātu Logout nostrādāšanu
            window.location.reload();
        }
    };

    // --- 4. SLUDINĀJUMU PĀRVALDĪBA ---
    const adsManager = {
        save: async () => {
            const title = document.getElementById('field-title').value;
            const price = document.getElementById('field-price').value;
            const file = document.getElementById('field-file').files[0];
            
            if(!title || !price) return alert("Lūdzu aizpildi virsrakstu un cenu!");

            let imgBase64 = "";
            if(file) {
                if(file.size > 2 * 1024 * 1024) return document.getElementById('file-error').style.display = 'block';
                imgBase64 = await new Promise(r => {
                    const reader = new FileReader();
                    reader.onload = e => r(e.target.result);
                    reader.readAsDataURL(file);
                });
            }

            const newAd = {
                id: Date.now(),
                brand: document.getElementById('field-brand').value,
                title: title,
                price: price,
                year: document.getElementById('field-year').value,
                desc: document.getElementById('field-desc').value,
                owner: store.session.get().name
            };
            // Bildi saglabājam atsevišķi vai šifrētu, ja nav par lielu
            newAd.img = imgBase64;

            let ads = store.load('ads', []);
            ads.unshift(newAd);
            store.save('ads', ads);

            alert("Sludinājums pievienots!");
            router.goto('home');
        },
        render: () => {
            const list = document.getElementById('ad-list');
            const filter = document.getElementById('filter-brand').value;
            const ads = store.load('ads', []);
            const user = store.session.get();

            const filtered = filter === 'Visi' ? ads : ads.filter(a => a.brand === filter);

            list.innerHTML = filtered.map(ad => `
                <div class="ad-card">
                    <img src="${ad.img || 'https://via.placeholder.com/300x180?text=Auto'}">
                    <div class="ad-content">
                        <div class="ad-price">${ad.price} €</div>
                        <b>${ad.brand} ${ad.title}</b><br>
                        <small>${ad.year}. gads | ${ad.owner}</small>
                        <p style="font-size: 13px; color: #666;">${ad.desc.substring(0, 60)}...</p>
                        ${(user.role === 'admin' || user.name === ad.owner) ? 
                            `<button onclick="adsManager.delete(${ad.id})" style="color:red; background:none; border:none; cursor:pointer; padding:0; font-size:12px;">Dzēst sludinājumu</button>` : ''}
                    </div>
                </div>
            `).join('');
        },
        delete: (id) => {
            if(!confirm("Tiešām dzēst?")) return;
            let ads = store.load('ads', []);
            ads = ads.filter(a => a.id !== id);
            store.save('ads', ads);
            adsManager.render();
        }
    };

    // --- 5. ADMIN PĀRVALDĪBA ---
    const adminManager = {
        render: () => {
            const users = store.load('users', []);
            document.getElementById('admin-user-list').innerHTML = `
                <table style="width: 100%; text-align: left; border-collapse: collapse;">
                    <tr style="border-bottom: 2px solid #333;"><th>Lietotājs</th><th>Loma</th></tr>
                    ${users.map(u => `<tr style="border-bottom: 1px solid #ddd; height: 40px;"><td>${u.name}</td><td>${u.role}</td></tr>`).join('')}
                </table>
            `;
        }
    };

    // --- STARTĒŠANA ---
    document.addEventListener('DOMContentLoaded', () => {
        if(store.session.get()) {
            auth.updateUI();
        }
    });
</script>

</body>
</html>